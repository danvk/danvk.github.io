<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>danvk.org &#187; programming</title>
	<atom:link href="http://www.danvk.org/wp/category/programming/feed/" rel="self" type="application/rss+xml" />
	<link>http://www.danvk.org/wp</link>
	<description>Keepin' static like wool fabric since 2006</description>
	<lastBuildDate>Thu, 09 Oct 2014 15:59:51 +0000</lastBuildDate>
	<language>en-US</language>
		<sy:updatePeriod>hourly</sy:updatePeriod>
		<sy:updateFrequency>1</sy:updateFrequency>
	<generator>http://wordpress.org/?v=3.9.2</generator>
	<item>
		<title>Finding Pictures in Pictures</title>
		<link>http://www.danvk.org/wp/2013-02-09/finding-pictures-in-pictures/</link>
		<comments>http://www.danvk.org/wp/2013-02-09/finding-pictures-in-pictures/#comments</comments>
		<pubDate>Sun, 10 Feb 2013 06:11:42 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[programming]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=1021</guid>
		<description><![CDATA[Over the past month, I&#8217;ve been working with imagery from the NYPL&#8217;s Milstein Collection. Astute readers may have some guesses why. The images look something like this one: There are two photos in this picture! They&#8217;re on cards set against a brown background. Other pictures in the Milstein gallery have one or three photos, with [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>Over the past month, I&#8217;ve been working with imagery from the NYPL&#8217;s <a href="http://digitalgallery.nypl.org/nypldigital/dgdivisionbrowseresult.cfm?div_id=hh">Milstein Collection</a>. Astute readers may have some guesses why. The images look something like <a href="http://digitalgallery.nypl.org/nypldigital/dgkeysearchdetail.cfm?strucID=405038&#038;imageID=715240f">this one</a>:</p>
<p><center><a style="border:none;" href="http://digitalgallery.nypl.org/nypldigital/dgkeysearchdetail.cfm?strucID=405038&#038;imageID=715240f"><img border=0 src="http://images.nypl.org/index.php?id=715240f&#038;t=w" width=490 height=760 /></a></center></p>
<p>There are two photos in this picture! They&#8217;re on cards set against a brown background. Other pictures in the Milstein gallery have one or three photos, with or without a white border:</p>
<p><center><img src="http://images.nypl.org/index.php?id=711018f&#038;t=r" width=194 height=300 /> &nbsp; <img src="http://images.nypl.org/index.php?id=715591f&#038;t=r" width=194 height=300 /> &nbsp; <img src="http://images.nypl.org/index.php?id=710504f&#038;t=r" width=194 height=300 /></center></p>
<p>To make something akin to <a href="http://oldsf.org/">OldSF</a>, I&#8217;d need to write a program to find and extract each of the photos embedded in these pictures. It&#8217;s incredibly easy for our eyes to pick out the embedded photos, but this is deceptive. We&#8217;re really good at this sort of thing! Teaching a computer to do makes you realize how non-trivial the problem is.</p>
<p>I started by converting the images to grayscale and running <a href="http://en.wikipedia.org/wiki/Edge_detection">edge detection</a>:<br />
<img src="http://www.danvk.org/wp/wp-content/uploads/2013/02/Screen-Shot-2013-02-10-at-12.47.42-AM.png" alt="edge detection" width="394" height="613" class="aligncenter size-full wp-image-1029" /></p>
<p>The white lines indicate places where there was an &#8220;edge&#8221; in the original image. It&#8217;s an impressive effect&mdash;almost like you hired someone to sketch the image. The details on the stoops are particularly cool:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/02/Screen-Shot-2013-02-10-at-12.48.19-AM.png" alt="Detail on edge detection image" width="553" height="392" class="aligncenter size-full wp-image-1030" /></p>
<p>The interesting bit for us isn&#8217;t the lines inside the photo so much as the white box around it. Running an edge detection algorithm brings it into stark relief. There are a number of image processing algorithms to detect lines, for example the <a href="http://en.wikipedia.org/wiki/Hough_Transform">Hough Transform</a> or scipy&#8217;s <a href="http://scikit-image.org/docs/0.3/auto_examples/plot_hough_transform.html#example-plot-hough-transform-py">probabilistic_hough</a>. I&#8217;ve never been able to get these to work, however, and this ultimately proved to be a dead end.</p>
<p>A simple algorithm often works much better than high-powered computer vision algorithms like edge detection and the Hough Transform. In this case, I realized that there was, in fact, a much simpler way to do things.</p>
<p>The images are always on brown paper. So why not find the brown paper and call everything else the photos? To do this, I found the median color in each image, blurred it and called everything within an RMSE of 20 &#8220;brown&#8221;. I colored the brown pixels black and the non-brown pixels white. This left me with an image like this:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/02/Screen-Shot-2013-02-10-at-1.00.29-AM.png" alt="Two white rectangles on a black background" width="533" height="847" class="aligncenter size-full wp-image-1032" /></p>
<p>Now this is progress! The rectangles stand out clearly. Now it&#8217;s a matter of teaching the computer to find them.</p>
<p>To do this, I used the following algorithm:</p>
<ol>
<li>Pick a random white pixel, (x, y) (statistically, this is likely to be in a photo)</li>
<li>Call this a 1&#215;1 rectangle.</li>
<li>Extend the rectangle out in all directions, so long as you keep adding new white pixels.</li>
<li>If this rectangle is larger than 100&#215;100, record it as a photo.</li>
<li>Color the rectangle black.</li>
<li>If &lt;90% of the image is black, go back to step 1.
</ol>
<p>Eventually this should find all the photos. Here are the results on the original photo from the top of the post:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/02/Screen-Shot-2013-02-10-at-1.07.23-AM.png" alt="Outlined Photos" width="545" height="847" class="aligncenter size-full wp-image-1034" /></p>
<p>The red rectangles are those found by the algorithm. This has a few nice properties:</p>
<ol>
<li>It naturally generalizes to images with 1, 2, 3, 4, etc. photos.</li>
<li>It still works well when the photos are slightly rotated.</li>
<li>It works for any background color (lighting conditions vary for each image).</li>
</ol>
<p>There&#8217;s still some tweaking to do, but I&#8217;m really happy with how this algorithm has performed! You can find the source code <a href="https://github.com/danvk/sfhistory/blob/master/nyc/find-pictures.py">here</a>.</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2013-02-09/finding-pictures-in-pictures/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>Developing the OldSF Slideshow</title>
		<link>http://www.danvk.org/wp/2013-01-21/developing-the-oldsf-slideshow/</link>
		<comments>http://www.danvk.org/wp/2013-01-21/developing-the-oldsf-slideshow/#comments</comments>
		<pubDate>Tue, 22 Jan 2013 02:21:10 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[programming]]></category>
		<category><![CDATA[san francisco]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=972</guid>
		<description><![CDATA[If you head over to oldsf.org, you&#8217;ll find a sleek new UI and a brand new slideshow feature. Here&#8217;s the before/after: &#160; Locations like the Sutro Baths can have hundreds of photos. The slideshow lets you flip through them quickly. As so often happens, what looked simple at first became more and more complex as [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>If you head over to <a href="http://oldsf.org/">oldsf.org</a>, you&#8217;ll find a sleek new UI and a brand new <a href="http://www.oldsf.org/#ll:37.780073|-122.513765&#038;e:AAC-0275|535&#038;m:37.78395|-122.47521|14">slideshow feature</a>. Here&#8217;s the before/after:</p>
<p><a href="http://www.danvk.org/wp/wp-content/uploads/2013/01/oldsf-before.png" style="border:none;"><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/oldsf-before-300x209.png" alt="OldSF &quot;expanded image&quot; view before update." width="300" height="209" class="aligncenter size-medium wp-image-974" style="display: inline-block;" border=0 /></a> &nbsp; <a href="http://www.danvk.org/wp/wp-content/uploads/2013/01/oldsf-after.png" style="border:none;"><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/oldsf-after-300x209.png" alt="oldsf-after" width="300" height="209" class="aligncenter size-medium wp-image-973" style="display: inline-block;" border=0 /></a></p>
<p>Locations like the <a href="http://en.wikipedia.org/wiki/Sutro_Baths">Sutro Baths</a> can have hundreds of photos. The slideshow lets you flip through them quickly.</p>
<p>As so often happens, what looked simple at first became more and more complex as I implemented it. Here&#8217;s how that process went for the OldSF update.<br />
<span id="more-972"></span><br />
It started with Raven&#8217;s mock of the feature:</p>
<p><a href="http://www.danvk.org/wp/wp-content/uploads/2013/01/oldsf-slideshow.jpeg" style="border:none;"><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/oldsf-slideshow.jpeg" alt="Raven&#039;s initial mocks for the OldSF slideshow." width="616" height="359" class="aligncenter size-full wp-image-995" /></a></p>
<p>I started by looking for a JavaScript library that could do most of the heavy lifting for me. Raven&#8217;s mock shows a single big image in the center with bits of the previous and next images visible on either side. After finding lots of &#8220;slideshow&#8221; libraries that <a href="http://www.slidesjs.com/">weren&#8217;t</a> <a href="https://github.com/Ephigenia/jquery.slideShow">quite</a> <a href="http://vandelaydesign.com/blog/web-development/jquery-slideshow/">right</a>, I realized that what I really wanted was called a &#8220;carousel&#8221;, not a &#8220;slideshow&#8221;. After making this conceptual breakthrough, I quickly settled on <a href="https://github.com/jsor/jcarousel">jCarousel</a>.</p>
<p>The slideshow/carousel was barely in place before I ran into a new problem: the images kept shifting out of place! The issue is that jCarousel lays out all the images in your slideshow in a big long line, like so:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/long-line-laptop.png" alt="Long strip of photos with with one visible" width="600" height="87" class="aligncenter size-full wp-image-986" /></p>
<p>Most of the images are off-screen. To change the &#8220;active&#8221; image, jCarousel slides the whole strip to the left or right. To save bandwidth, I try not to load images that you&#8217;ll never see. An image only gets loaded when it appears on the screen. Before it loaded, I had no idea what its width was. The long strip of images really looked like this:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/long-line-laptop-1.png" alt="long-line-laptop-1" width="600" height="87" class="aligncenter size-full wp-image-1006" /></p>
<p>If an image turned out to be wider than expected, then the browser would push all the later images farther to the right, like so:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/long-line-laptop-2.png" alt="long-line-laptop-2" width="600" height="87" class="aligncenter size-full wp-image-1005" /></p>
<p>This wreaked havoc on the carousel&#8217;s layout. It could budge the center image all the way off the screen!</p>
<p>At first, I told jCarousel to redo its layout whenever a new image loaded. This mostly prevented the budging, but it had a nasty side effect. Images typically get loaded when you scroll through the slideshow. This scrolling is animated. But if jCarousel redid the layout, then the animation would suddenly stop and the motion would look very janky. My first thought was to prevent the relayout during animations, and this is what I did for our initial &#8220;launch&#8221;. But a few days later, Raven told me that she wasn&#8217;t consistently seeing the correct image when she copy/pasted links to the slideshow. The layout issues weren&#8217;t gone!</p>
<p>The source of all this complexity was the images in the slideshow with unknown widths. So the cleanest solution was to make them known! I added image width and height to the database and propagated them through to the client. This meant that the layout never had to change when an image loaded. Using the same schematic as above, the carousel looked like this:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/long-line-laptop-3.png" alt="long-line-laptop-3" width="600" height="87" class="aligncenter size-full wp-image-1004" /></p>
<p>With the layout fixed, all the hacks I&#8217;d written melted away and the slideshow links turned rock solid.</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/layout-clash.png" alt="Google Maps navigation and OldSF logo overlapping" width="282" height="265" class="alignleft size-full wp-image-987" /> Another surprisingly tricky part involved moving the Google Maps navigation controls. In our new UI, the map uses the full window. The logo, date range selector and right-hand panel &#8220;float&#8221; above the map. When I first implemented it, I saw the mess you see to the left.</p>
<p>Uh-oh! I assumed this would be easy to fix&mdash;just shove the Google Maps navigation down a bit. But Google Maps doesn&#8217;t expose any CSS classes for its controls, so this turns out to be quite tricky. With some help from the <a href="https://developers.google.com/maps/documentation/javascript/controls">API docs</a> and <a href="http://stackoverflow.com/questions/2934269/google-maps-api-v3-custom-controls-position">this StackOverflow question</a> I learned that the only way to do this is to create a small, invisible custom maps control which shoves all the other controls out of the way. Sheesh. The invisible control is outlined in this image:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/layout-fixed.png" alt="Layout fixed using an invisible control." width="290" height="273" class="aligncenter size-full wp-image-989" /></p>
<p>Another fun issue came up with Street View. Having Street View on OldSF is quite useful, since it lets you do &#8220;now and then&#8221; comparisons. But when we went to the full-screen map layout, we ran into this annoyance:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2013/01/x-in-the-corner.png" alt="The Street View close button is covered by the right-hand panel of images." width="405" height="259" class="alignleft size-full wp-image-992" /> That &#8220;x&#8221; button in the top right corner is the <i>only</i> way to get out of street view, and it&#8217;s covered by the right-hand panel. You&#8217;re stuck! The solution here was to find the events corresponding to entering and leaving Street View. When you go into Street View, we hide our UI elements. When you leave, we show them again. Raven has suggested that it&#8217;s nice to still see the images, so in the future I may just shove the right-hand panel down a bit or provide my own exit button.</p>
<p>Those were three of the most interesting issues I ran into while creating this new feature. There were many, many more. Nothing is ever so simple as it seems!</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2013-01-21/developing-the-oldsf-slideshow/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Lonely Hangouts</title>
		<link>http://www.danvk.org/wp/2012-06-25/lonely-hangouts/</link>
		<comments>http://www.danvk.org/wp/2012-06-25/lonely-hangouts/#comments</comments>
		<pubDate>Mon, 25 Jun 2012 21:35:38 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[programming]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=912</guid>
		<description><![CDATA[While working on Puzzle+, my crossword application for Google+ Hangouts, I couldn&#8217;t help but notice what a colossal pain it was to develop against the Hangouts API. It has a few things going against it: Testing your changes requires pushing them to a remote HTTPS server. Your application is buried in a ton of iframes, [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>While working on <a href="/wp/2012-05-17/puzzle-crosswords-for-google/">Puzzle+</a>, my crossword application for Google+ Hangouts, I couldn&#8217;t help but notice what a colossal pain it was to develop against the Hangouts API. It has a few things going against it:</p>
<ul>
<li>Testing your changes requires pushing them to a remote HTTPS server.</li>
<li>Your application is buried in a ton of <code>iframe</code>s, which makes the JS console harder to use.</li>
<li>Opening up Google+ Hangouts runs a browser plugin, turns on your camera, and makes your computer nice and toasty-hot.</li>
<li>It&#8217;s impossible to test multiplayer scenarios without multiple Google+ accounts and multiple <i>computers</i> (since opening a hangout requires exclusive access to your camera).</li>
</ul>
<p>To make myself less sad, I developed a small node.js server which emulates the Google+ Hangouts API. This lets you do all your development (both single- and multi-player) locally, without any of the AV overhead that Hangouts usually bring in.</p>
<p>In case anyone else finds themselves in a similar predicament, I&#8217;ve released this code as <a href="https://github.com/danvk/lonely"><i>Lonely Hangouts</i></a> on github.</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2012-06-25/lonely-hangouts/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>puzzle+: Crosswords for Google+</title>
		<link>http://www.danvk.org/wp/2012-05-17/puzzle-crosswords-for-google/</link>
		<comments>http://www.danvk.org/wp/2012-05-17/puzzle-crosswords-for-google/#comments</comments>
		<pubDate>Thu, 17 May 2012 15:48:12 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[programming]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=867</guid>
		<description><![CDATA[To solve a crossword with your friends in Google+, click this giant hangout button: You&#8217;ll see something like this: Click &#8220;Hang out&#8221; to invite everyone in your circles to help you with the puzzle. If you want to collaborate with just one or two people, click the &#8220;x&#8221; on &#8220;Your Circles&#8221; and then click your [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>To solve a crossword with your friends in Google+, click this giant hangout button:</p>
<p style="text-align: center; padding: 20px 0;"><a href="https://plus.google.com/hangouts/_?gid=816682636912" style="text-decoration:none;"><img src="https://ssl.gstatic.com/s2/oz/images/stars/hangout/1/gplus-hangout-60x230-normal.png" alt="Start a Hangout" style="border:0;width:230px;height:60px;"/></a></p>
<p>You&#8217;ll see something like this:</p>
<p style="text-align: center;"><img src="http://www.danvk.org/wp/wp-content/uploads/2012/05/circles-people.png" alt="" title="circles-people" width="523" height="401" class="aligncenter size-full wp-image-883" /></p>
<p>Click &#8220;Hang out&#8221; to invite everyone in your circles to help you with the puzzle. If you want to collaborate with just one or two people, click the &#8220;x&#8221; on &#8220;Your Circles&#8221; and then click your friend&#8217;s names on the right.</p>
<p>You&#8217;ll be prompted to either upload a .puz file or play one of the built-in Onion puzzles. You can get a free puzzle from the New York Times by clicking &#8220;Play in Across Lite&#8221; on <a href="http://www.nytimes.com/ref/crosswords/classicpuz.html?ref=crosswords">this page</a>.</p>
<p>With the puzzle downloaded, drag it into the drop area:</p>
<p style="text-align: center;"><img src="http://www.danvk.org/wp/wp-content/uploads/2012/05/dragging-e1337269129570.png" alt="" title="dragging" width="608" height="413" class="aligncenter size-full wp-image-874" /></p>
<p>And now you&#8217;re off to the races! The big win of doing this in a Google+ hangout is that you get to video chat with your collaborators while you&#8217;re solving the puzzle, just like you would in person!</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2012/05/screenshot.png" alt="" title="screenshot" width="900" height="577" class="size-full wp-image-875" style="max-width: 900px;" /></p>
<p>Astute readers will note that puzzle+ is a revival of <a href="/wp/2011-03-27/crosscountry-crosswords/">lmnopuz for Google Shared Spaces</a>, which was a revival of <a href="/wp/2010-03-22/introducing-lmnowave/">lmnowave</a> (Crosswords for Google Wave), which was in turn a revival of <a href="http://neugierig.org/">Evan Martin</a> and <a href="http://www.erat.org/">Dan Erat</a>&#8216;s standalone <a href="http://neugierig.org/software/lmnopuz/">lmnopuz</a>. Hopefully the Google+ Hangouts API will be more long-lived than its predecessors.</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2012-05-17/puzzle-crosswords-for-google/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Horizontal and Vertical Centering with CSS</title>
		<link>http://www.danvk.org/wp/2012-05-14/horizontal-and-vertical-centering-with-css/</link>
		<comments>http://www.danvk.org/wp/2012-05-14/horizontal-and-vertical-centering-with-css/#comments</comments>
		<pubDate>Mon, 14 May 2012 17:04:47 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[programming]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=854</guid>
		<description><![CDATA[I recently wanted to center some content both vertically and horizontally on a web page. I did not know in advance how large the content was, and I wanted it to work for any size browser window. These two articles have everything you need to know about horizontal centering and vertical centering. The two articles [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>I recently wanted to center some content both vertically and horizontally on a web page. I did not know in advance how large the content was, and I wanted it to work for any size browser window.</p>
<p>These two articles have everything you need to know about <a href="http://haslayout.net/css-tuts/Horizontal-Centering">horizontal centering</a> and <a href="http://haslayout.net/css-tuts/Vertical-Centering">vertical centering</a>.</p>
<p>The two articles don&#8217;t actually combine the techniques, so I&#8217;ll do that here.</p>
<p>In the bad old days before CSS, you might accomplish this with tables:</p>
<pre class="brush: xml; title: ; notranslate">
&lt;table width=100% height=100%&gt;
  &lt;tr&gt;
    &lt;td valign=middle align=center&gt;
      Content goes here
    &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</pre>
<p>Simple enough! In the wonderful world of HTML5, you do the same thing by turning <code>div</code>s into <code>table</code>s using CSS. You need no fewer than <i>three</i> divs to pull this off:</p>
<pre class="brush: xml; title: ; notranslate">
&lt;div class=&quot;container&quot;&gt;
  &lt;div class=&quot;middle&quot;&gt;
    &lt;div class=&quot;inner&quot;&gt;
      Content goes here
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;
</pre>
<p>And here&#8217;s the CSS:</p>
<pre class="brush: css; title: ; notranslate">
.container {
  display: table;
  width: 100%;
  height: 100%;
}
.middle {
  display: table-cell;
  vertical-align: middle;
}
.inner {
  display: table;
  margin: 0 auto;
}
</pre>
<p>A few comments on why this works:</p>
<ul>
<li>You can only apply <code>vertical-align: middle</code> to an element with <code>display: table-cell</code>. (Hence <code>.middle</code>)
<li>You can only apply <code>display: table-cell</code> to an element inside of another element with <code>display: table</code>. (Hence <code>.container</code>)
<li>Elements with <code>display: block</code> have 100% width by default. Setting <code>display: table</code> has the side effect of shrinking the div to fit its content, while still keeping it a block-level element. This, in turn, enables the <code>margin: 0 auto</code> trick. (Hence <code>.inner</code>)
</ul>
<p>I believe all three of these divs are genuinely necessary. For the common case that you want to center elements on the entire screen, you can make <code>.container</code> the <code>body</code> tag to get rid of one div.</p>
<p>In the future, this will get slightly easier with <a href="http://www.the-haystack.com/2012/01/04/learn-you-a-flexbox/">display: flexbox</a>, a box model which makes infinitely more sense for layout than the existing CSS model. You can read about how do to horizontal and vertical centering using flexbox <a href="http://www.kirupa.com/html5/centering_vertically_horizontally.htm">here</a>.</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2012-05-14/horizontal-and-vertical-centering-with-css/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Accurate hexadecimal to decimal conversion in JavaScript</title>
		<link>http://www.danvk.org/wp/2012-01-20/accurate-hexadecimal-to-decimal-conversion-in-javascript/</link>
		<comments>http://www.danvk.org/wp/2012-01-20/accurate-hexadecimal-to-decimal-conversion-in-javascript/#comments</comments>
		<pubDate>Fri, 20 Jan 2012 23:05:20 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[javascript]]></category>
		<category><![CDATA[programming]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=824</guid>
		<description><![CDATA[A problem came up at work yesterday: I was creating a web page that received 64-bit hex numbers from one API. But it needed to pass them off to another API that expected decimal numbers. Usually this would not be a problem &#8212; JavaScript has built-in functions for converting between hex and decimal: parseInt("1234abcd", 16) [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>A problem came up at work yesterday: I was creating a web page that received 64-bit hex numbers from one API. But it needed to pass them off to another API that expected decimal numbers.</p>
<p>Usually this would not be a problem &mdash; JavaScript has built-in functions for converting between hex and decimal:</p>
<p><code>parseInt("1234abcd", 16) = 305441741<br />
(305441741).toString(16) = "1234abcd"</code></p>
<p>Unfortunately, for larger numbers, there&#8217;s a big problem lurking:</p>
<p><code>parseInt("123456789abcd<u>ef</u>", 16) = 81985529216486900<br />
(81985529216486900).toString(16) = "123456789abcd<u>f0</u>"<br />
</code></p>
<p>The last two digits are wrong. Why did these functions stop being inverses of one another?</p>
<p>The answer has to do with how JavaScript stores numbers. It uses 64-bit floating point representation for all numbers, even integers. This means that integers larger than 2^53 cannot be represented precisely. You can see this by evaluating:</p>
<p><code>(Math.pow(2, 53) + 1) - 1 = 9007199254740991</code></p>
<p>That ends with a 1, so whatever it is, it&#8217;s certainly not a power of 2. (It&#8217;s off by one).</p>
<p>To solve this problem, I wrote some very simple hex &lt;-&gt; decimal conversion functions which use arbitrary precision arithmetic. In particular, these will work for 64-bit numbers or 128-bit numbers. The code is only about 65 lines, so it&#8217;s much more lightweight than a full-fledged library for arbitrary precision arithmetic.</p>
<p>The algorithm is pretty cool. You can see a demo, read an explanation and get the code here:<br />
<a href="http://danvk.org/hex2dec.html">http://danvk.org/hex2dec.html</a>.</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2012-01-20/accurate-hexadecimal-to-decimal-conversion-in-javascript/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Takeaways from Stanford&#8217;s Machine Learning Class</title>
		<link>http://www.danvk.org/wp/2011-12-19/takeaways-stanfords-machine-learning-class/</link>
		<comments>http://www.danvk.org/wp/2011-12-19/takeaways-stanfords-machine-learning-class/#comments</comments>
		<pubDate>Tue, 20 Dec 2011 00:04:33 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[math]]></category>
		<category><![CDATA[programming]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=782</guid>
		<description><![CDATA[Over the past two months, I&#8217;ve participated in Andrew Ng&#8217;s online Stanford Machine learning class. It&#8217;s a very high-level overview of the field with an emphasis on applications and techniques, rather than theory. Since I just finished the last assignment, it&#8217;s a fine time to write down my thoughts on the class! Overall, I&#8217;ve learned [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>Over the past two months, I&#8217;ve participated in Andrew Ng&#8217;s online <a href="http://ml-class.org">Stanford Machine learning class</a>. It&#8217;s a very high-level overview of the field with an emphasis on applications and techniques, rather than theory. Since I just finished the last assignment, it&#8217;s a fine time to write down my thoughts on the class!</p>
<p>Overall, I&#8217;ve learned quite a bit about how <a href="http://en.wikipedia.org/wiki/Machine_learning">ML</a> is used in practice. Some highlights for me:</p>
<style type="text/css">ul.body-list li { padding-bottom: 10px; }</style>
<ul class="body-list">
<li><a href="http://en.wikipedia.org/wiki/Gradient_descent">Gradient descent</a> is a very general optimization technique. If you can calculate a function and its partial derivatives, you can use gradient descent. I was particularly impressed with the way we  used it to train Neural Networks. We learned how the networks operated, but had no need to think about how to train them &mdash; we just used gradient descent.
<li>There are <a href="http://en.wikipedia.org/wiki/BFGS_method">many</a> advanced &#8220;unconstrained optimization&#8221; algorithms which can be used as alternatives to gradient descent. These often have the advantage that you don&#8217;t need to tune parameters like a learning rate.
<li><a href="http://en.wikipedia.org/wiki/Regularization_(machine_learning)">Regularization</a> is used almost universally. I&#8217;d previously had very negative associations with using high-order polynomial features, since I most often saw them used in examples of overfitting. But I realize now that they are quite reasonable to add if you also make good use of regularization.
<li>The <a href="http://en.wikipedia.org/wiki/Backpropagation">backpropagation algorithm</a> for <a href="http://en.wikipedia.org/wiki/Artificial_neural_network">Neural Networks</a> is really just an efficient way to compute partial derivatives (for use by gradient descent and co).
<li>Learning curves (plots of train/test error as a function of the number of examples) are a great way to figure out how to improve your ML algorithm. For example, if your training and test errors are both high, it means that you&#8217;re not overfitting your data set and there&#8217;s no point in gathering more data. What it does mean is that you need to add more features (e.g. the polynomial which I used to fear) in order to increase your performance.
</ul>
<p>The other takeaway is that, as in many fields, there are many &#8220;tricks of the trade&#8221; in Machine Learning. These are bits of knowledge that aren&#8217;t part of the core theory, but which are still enormously helpful for solving real-world problems.</p>
<p>As an example, consider the last problem in the course: Photo OCR. The problem is to take an image like this:</p>
<p><img src="http://www.danvk.org/wp/wp-content/uploads/2011/12/photo-ocr-e1324338543864.png" alt="Example of Photo OCR" title="photo-ocr" width="531" height="362" class="aligncenter size-full wp-image-783" /></p>
<p>and extract all the text: &#8220;LULA B&#8217;s ANTIQUE MALL&#8221;, &#8220;LULA B&#8217;s&#8221;, &#8220;OPEN&#8221; and &#8220;Lula B&#8217;s&#8221;. Initially, this seems quite daunting. Machine Learning is clearly relevant here, but how do you break it down into concrete problems which can be attacked using ML techniques? You don&#8217;t know where the text is and you don&#8217;t even have a rough idea of the text&#8217;s size.</p>
<p>This is where the &#8220;tricks&#8221; come in. <a href="http://en.wikipedia.org/wiki/Binary_classification">Binary classifiers</a> are the &#8220;hammer&#8221; of ML. You can write a binary classifier to determine whether a fixed-size rectangle contains text:</p>
<table>
<tr>
<td><i>Positive examples</i></td>
<td><img src="http://www.danvk.org/wp/wp-content/uploads/2011/12/text-negative.png" alt="" title="text-positive" width="383" height="75" class="alignleft size-full wp-image-785" /></td>
</tr>
<tr>
<td><i>Negative examples</i></td>
<td><img src="http://www.danvk.org/wp/wp-content/uploads/2011/12/text-positive.png" alt="" title="text-negative" width="384" height="75" class="alignleft size-full wp-image-784" /></td>
</tr>
</table>
<p>You then run this classifier over thousands of different &#8220;windows&#8221; in the main image. This tells you where all the bits of text are. If you ignore all the non-contiguous areas, you have a pretty good sense of the bounding boxes for the text in the image.</p>
<p>But even given the text boxes, how do you recognize the characters? Time for another trick! We can build a binary classifier to detect a gap between letters in the center of a fixed-size rectangle:</p>
<table>
<tr>
<td><i>Positive examples</i></td>
<td><img src="http://www.danvk.org/wp/wp-content/uploads/2011/12/split-positive.png" alt="" title="split-positive" width="143" height="94" class="alignleft size-full wp-image-791" /></td>
</tr>
<tr>
<td><i>Negative examples</i></td>
<td><img src="http://www.danvk.org/wp/wp-content/uploads/2011/12/split-negative.png" alt="" title="split-negative" width="143" height="94" class="alignleft size-full wp-image-791" /></td>
</tr>
</table>
<p>If we slide this along, it will tell us where each character starts and ends. So we can chop the text box up into character boxes. Once we&#8217;ve done that, classifying characters in a fixed-size rectangle is another concrete problem which can be tackled with Neural Networks or the like.</p>
<p>In an ML class, you&#8217;re presented with this pipeline of ML algorithms for the Photo OCR problem. It makes sense. It reduces the real-world problem into three nice clean, theoretical problems. In the class, you&#8217;d likely spend most of your time talking about those three concrete problems. In retrospect, the pipeline seems as natural as could be.</p>
<p>But if you were given the Photo OCR problem in the real world, you might never come up with this breakdown. Unless you knew the trick! And the only way to learn tricks like this is to see them used. And that&#8217;s my final takeaway from this practical ML class: familiarity with a vastly larger set of ML tricks.</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2011-12-19/takeaways-stanfords-machine-learning-class/feed/</wfw:commentRss>
		<slash:comments>1</slash:comments>
		</item>
		<item>
		<title>Java, Ten Years Later</title>
		<link>http://www.danvk.org/wp/2011-11-05/java-ten-years-later/</link>
		<comments>http://www.danvk.org/wp/2011-11-05/java-ten-years-later/#comments</comments>
		<pubDate>Sat, 05 Nov 2011 20:33:54 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[programming]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=765</guid>
		<description><![CDATA[It&#8217;s been almost ten years since I&#8217;ve actively used the Java programming language. In the mean time, I&#8217;ve mostly used C++. I&#8217;ve had to pick up a bit of Java again recently. Here are a few of the things that I found surprising or notable. These are all variants on &#8220;that&#8217;s changed in the last [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>It&#8217;s been almost ten years since I&#8217;ve actively used the <a href="http://en.wikipedia.org/wiki/Java_(programming_language)">Java</a> programming language. In the mean time, I&#8217;ve mostly used <a href="http://en.wikipedia.org/wiki/C%2B%2B">C++</a>. I&#8217;ve had to pick up a bit of Java again recently. Here are a few of the things that I found surprising or notable. These are all variants on &#8220;that&#8217;s changed in the last ten years&#8221; or &#8220;that&#8217;s not how C++ does it.&#8221;</p>
<p><b>The Java compiler enforces what would be conventions in C++.</b><br />
For example, &#8220;public class Foo&#8221; has to be in Foo.java. In C++, this would just be a convention. You can use &#8220;private class&#8221; when you&#8217;re playing around with test code and want to use only a single file. Similarly, class foo.Bar needs to be in &#8220;foo/Bar.java&#8221;.</p>
<p><b>Java Packages are a more pervasive concept than namespaces in C++.</b><br />
There&#8217;s a &#8220;default package&#8221;, but using this prevents you from loading classes by name: Class.fromName(&#8220;Foo&#8221;) won&#8217;t work, but Class.fromName(&#8220;package.Foo&#8221;) will. Classes in your current package are auto-imported, which surprised me at first. The default visibility for methods/fields in Java is &#8220;package private&#8221;, which has no analogue in C++.</p>
<p><b>Java keeps much more type information at runtime time than C++ does.</b><br />
The reflection features (Class.getMethods(), Method.getParameters(), etc.) have no equivalent in C++. This leads to some seemingly-magical behaviors, e.g. naming a method &#8220;foo&#8221; in a Servlet can cause it to be served at &#8220;/foo&#8221; without you saying anything else. Not all information is kept though: you can get a list of all packages, but not a list of all classes in a package. You can request a class by its name, but you can&#8217;t get a list of all classes. You can get a list of all the method names in a class, but you can&#8217;t get a list of all the parameter names in a method.</p>
<p><b>Java enums are far richer than C/C++ enums.</b><br />
enums in Java are more like classes: they can have constructors, methods, fields, even per-value method implementations. I really like this. Examples:</p>
<p><code>public enum Suit {<br />
&nbsp; CLUB("C"), DIAMOND("D"), HEART("S"), SPADE("S");<br />
&nbsp; private String shortName;<br />
&nbsp; private Suit(shortName) { this.shortName = shortName; }<br />
&nbsp; public String toString() { return shortName; }<br />
}<br />
</code></p>
<p><b>Java is OK with a two-tier type system.</b><br />
At its core, C++ is an attempt to put user-defined types on an equal footing with built-in types like int and char. This is in no way a goal of Java, which is quite content to have a two-tier system of primitive and non-primitive types. This means that you can&#8217;t do Map&lt;int, int&gt;, for instance. You have to do Map&lt;Integer, Integer&gt;. Autoboxing makes this less painful, but it&#8217;s still a wart in the language that you have to be aware of.</p>
<p>One concrete example of this is the &#8220;array[index]&#8221; notation. In C++, this is also used for maps. There&#8217;s no way to do this in Java, and I really miss it. Compare:</p>
<p><code>map[key] += 1;</code></p>
<p>to</p>
<p><code>map.put(key, 1 + map.get(key));</code></p>
<p>which has more boilerplate and is more error-prone, since you might accidentally do:</p>
<p><code>map.put(key, 1 + other_map.get(key));</code></p>
<p><b>The designers of Java Generics learned from the chaos of C++ templates.</b><br />
Generic classes in Java are always templated on types: no more insane error messages. You can even say what interface the type has to implement. And there&#8217;s no equivalent of method specialization, a C++ feature which is often misused.</p>
<p><b>Variables/fields in Java behave more like C++ pointers than C++ values.</b><br />
This is a particular gotcha for a field. For example, in C++:</p>
<p><code>class C {<br />
&nbsp;public:<br />
&nbsp; C() {<br />
&nbsp; &nbsp; // foo_ is already constructed and usable here.<br />
&nbsp; }<br />
&nbsp;private:<br />
&nbsp; Foo foo_;<br />
};<br />
</code></p>
<p>But in Java:</p>
<p><code>class C {<br />
&nbsp; public C() {<br />
&nbsp; &nbsp; // foo is null here. We have to do foo = new Foo();<br />
&nbsp; }<br />
&nbsp; private Foo foo;<br />
}<br />
</code></p>
<p><b>Java constructors always require a trailing (), even if they take no parameters.</b><br />
This is a minor gotcha, but one I find myself running into frequently. It&#8217;s &#8220;new Foo()&#8221; instead of &#8220;new Foo&#8221; (which is acceptable in C++).</p>
<p><b>The Java foreach loop is fantastic</b><br />
Compare</p>
<p><code>for (String arg : args) { ... }</code></p>
<p>to</p>
<p><code>for (Set&lt;string&gt;::const_iterator it = args.begin(); it != args.end(); ++it) { ... }</code></p>
<p><b>The &#8220;static {}&#8221; construct is nice</b><br />
This lets you write code to initialize static variables. It has no clear analogue in C++. To use the Suit example above,</p>
<p><code>private static HashMap&lt;String, Suit&gt; name_to_suit;<br />
static {<br />
&nbsp; for (Suit s : Suit.values()) { name_to_suit.put(s.toString(), s); }<br />
}<br />
</code></p>
<p>The new features (Generics, enums, autoboxing) that Java has gained in the last ten years make it much more pleasant to use.</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2011-11-05/java-ten-years-later/feed/</wfw:commentRss>
		<slash:comments>3</slash:comments>
		</item>
		<item>
		<title>Crosscountry Crosswords</title>
		<link>http://www.danvk.org/wp/2011-03-27/crosscountry-crosswords/</link>
		<comments>http://www.danvk.org/wp/2011-03-27/crosscountry-crosswords/#comments</comments>
		<pubDate>Sun, 27 Mar 2011 21:07:05 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[personal]]></category>
		<category><![CDATA[programming]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=749</guid>
		<description><![CDATA[It&#8217;s been almost a year since I introduced lmnowave, the collaborative crossword puzzle gadget for Google Wave. A lot has happened in that past year, not least the cancelation of Wave. First, to clear up some confusion. It&#8217;s not &#8220;I&#8217;m no wave&#8221;, it&#8217;s &#8220;L-M-N-O-Wave&#8221;, which is a play on &#8220;L-M-N-O-Puz&#8221;, aka lmnopuz, the software on [&#8230;]]]></description>
				<content:encoded><![CDATA[<p><img src="http://www.danvk.org/wp/wp-content/uploads/2010/03/logo.png" alt="logo" title="logo" width="167" height="101" align="right" class="alignright size-full wp-image-688" />It&#8217;s been almost a year since I introduced <a href="/wp/2010-03-22/introducing-lmnowave/">lmnowave</a>, the collaborative crossword puzzle gadget for <a href="http://wave.google.com/">Google Wave</a>. A lot has happened in that past year, not least the cancelation of Wave.</p>
<p>First, to clear up some confusion. It&#8217;s not &#8220;I&#8217;m no wave&#8221;, it&#8217;s &#8220;L-M-N-O-Wave&#8221;, which is a play on &#8220;L-M-N-O-Puz&#8221;, aka <a href="http://neugierig.org/software/lmnopuz/">lmnopuz</a>, the software on which my collaborative crossword system is based. Only a few dozen people ever saw lmnopuz, so no one got the joke. And I realized after releasing it that, by changing &#8216;puz&#8217; -&gt; &#8216;wave&#8217;, I&#8217;d taken away any hint of what my wave gadget actually did. A bad name. Oh well.</p>
<p>In August, Google announced that <a href="http://googleblog.blogspot.com/2010/08/update-on-google-wave.html">Wave was canceled</a>. This seemed to be the end of lmnowave. Sure, Wave was still usable. But the life had been sucked out of the project. This was quite disappointing to me, since I&#8217;d spent a fair bit of my own time developing the crossword gadget.</p>
<p>Then, in mid-December, Douwe Osinga <a href="http://googlewave.blogspot.com/2010/12/announcing-google-shared-spaces.html">introduced</a> the oddly-named <a href="http://sharedspaces.googlelabs.com/">Google Shared Spaces</a>. It&#8217;s an attempt to salvage the Wave gadget code, to let it live outside of Wave.</p>
<p>For lmnopuz, it&#8217;s perfect. Here&#8217;s the <a href="http://sharedspaces.googlelabs.com/gallery/app?app_id=96001">lmnowave shared space</a>. You can use it to collaborate on crosswords with your friends, just like you could with lmnowave. In some ways, it&#8217;s even better, since the Wave UI is stripped away and you can focus on your puzzle. To do crosscountry crosswords, my <a href="http://ericaricardo.com/">friend</a> and I open up a shared space and call each other on Skype. The combination works really well.</p>
<p>What does the future hold for lmnowave? It&#8217;s a bit unclear. I may turn it into a Facebook game, or perhaps use it to learn how to write applications for the <a href="http://www.apple.com/mac/app-store/">Mac App store</a>.</p>
<p>Enjoy!</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2011-03-27/crosscountry-crosswords/feed/</wfw:commentRss>
		<slash:comments>0</slash:comments>
		</item>
		<item>
		<title>Commacopy</title>
		<link>http://www.danvk.org/wp/2011-03-09/commacopy/</link>
		<comments>http://www.danvk.org/wp/2011-03-09/commacopy/#comments</comments>
		<pubDate>Wed, 09 Mar 2011 15:16:08 +0000</pubDate>
		<dc:creator><![CDATA[danvk]]></dc:creator>
				<category><![CDATA[programming]]></category>
		<category><![CDATA[web]]></category>

		<guid isPermaLink="false">http://www.danvk.org/wp/?p=720</guid>
		<description><![CDATA[At work, I often see web pages that display large numbers like so: num-bytes 1,234,567,890 num-entries 123,456,789 Including the commas in the display makes the numbers easier to read. But it does have a downside. Say you want to calculate the average number of bytes per entry. If you copy/paste the numbers above, the commas [&#8230;]]]></description>
				<content:encoded><![CDATA[<p>At work, I often see web pages that display large numbers like so:</p>
<table>
<tr>
<td>num-bytes</td>
<td>1,234,567,890</td>
</tr>
<tr>
<td>num-entries</td>
<td>123,456,789</td>
</tr>
</table>
<p>Including the commas in the display makes the numbers easier to read. But it does have a downside. Say you want to calculate the average number of bytes per entry. If you copy/paste the numbers above, the commas will prevent most programming languages (e.g. <a href="http://en.wikipedia.org/wiki/Python_(programming_language)">python</a> or <a href="http://en.wikipedia.org/wiki/Bc_programming_language">bc</a>) from interpreting them correctly.</p>
<p>My coworker <a href="http://dsandler.org/wp/">Dan</a> came up with a great solution to this conundrum using CSS. Try copy/pasting these numbers over into the text box:</p>
<style type="text/css">.pre-comma:before { content:","; }</style>
<table>
<tr valign="top">
<td valign="top" width="50%">
<ul>
<li>1<span class='pre-comma'>234</span> <b> or </b> 2<span class='pre-comma'>345</span>
<li>-12<span class='pre-comma'>345</span>.67
<li>-123<span class='pre-comma'>456</span><span class='pre-comma'>789</span></ul>
</td>
<td valign="top"><textarea rows=4 cols=30></textarea></td>
</tr>
</table>
<p>The commas don&#8217;t copy! Best of both worlds!</p>
<p>You can view source to see how it works, but let&#8217;s jump straight to the goodies:</p>
<p><!-- hoisted from https://www.squarefree.com/bookmarklets/ --></p>
<style type="text/css">a.bml { border:1px outset #ddd; padding: 1px; vertical-align: 1px; background: #ddd; text-decoration: none;  font-family: sans-serif; color: darkgreen; }</style>
<p><b>Bookmarklet: </b><a class="bml" href="javascript:var%20s%20=%20document.getElementsByTagName(%27*%27);var%20re%20=%20/[-+]?(\d{1,3})(,\d\d\d)+(\.\d*)?/;var%20changed%20=%20false;for%20(var%20i%20=%200;%20i%20<%20s.length;%20i++)%20{var%20el%20=%20s[i];for%20(var%20j%20=%200;%20j%20<%20el.childNodes.length;%20j++)%20{if%20(el.childNodes[j].nodeType%20==%203)%20{var%20txtEl%20=%20el.childNodes[j];var%20txt%20=%20txtEl.nodeValue;if%20(txt.match(re))%20{changed%20=%20true;var%20new_span%20=%20document.createElement(%22span%22);new_span.innerHTML%20=%20txt.replace(/,(\d\d\d)/g,%22<span%20class=%27pre-comma%27>$1</span>%22);el.replaceChild(new_span,%20txtEl);}}}}if%20(changed)%20{var%20rule%20=%20%22content:%20%27,%27;%22;var%20styleSheetElement%20=%20document.createElement(%22style%22);styleSheetElement.type%20=%20%22text/css%22;document.getElementsByTagName(%22head%22)[0].appendChild(styleSheetElement);for%20(var%20i%20=%200;%20i%20<%20document.styleSheets.length;%20i++)%20{if%20(document.styleSheets[i].disabled)%20continue;var%20mysheet%20=%20document.styleSheets[i];try%20{if%20(mysheet.insertRule)%20{var%20idx%20=%20mysheet.cssRules%20?%20mysheet.cssRules.length%20:%200;mysheet.insertRule(%22.pre-comma:before%20{%20%22%20+%20rule%20+%20%22%20}%22,%20idx);}%20else%20if%20(mysheet.addRule)%20{mysheet.addRule(%22.pre-comma:before%22,%20rule);}return;}%20catch(err)%20{}}}">commacopy</a></span></p>
<p><b>Unobtrusive JavaScript: </b><a href="/commacopy/commacopy.js">commacopy.js</a></p>
<p>To use the bookmarklet, drag it to your browser&#8217;s bookmarks toolbar. If you click it, it will silently convert all numbers containing commas on the current page to the fancy copy/pasteable commas. This should really be a Chrome extension that runs on every page, but I&#8217;ll leave that as an exercise for the reader.</p>
<p>To use the unobtrusive JS, make a copy of <a href="/commacopy/commacopy.js">commacopy.js</a> and include it in your page via:<br />
<code><br />
&lt;script src="commacopy.js" language="text/javascript"&gt;&lt;script&gt;<br />
</code></p>
<p>commacopy works by converting a number like:<br />
<code><br />
123,456,789<br />
</code></p>
<p>into this HTML:<br />
<code><br />
&lt;style type="text/css"&gt;<br />
.pre-comma:before {<br />
&nbsp;&nbsp;content: ",";<br />
}<br />
&lt;/style&gt;<br />
123&lt;span class='pre-comma'&gt;456&lt;/span&gt;&lt;span class='pre-comma'&gt;789&lt;/span&gt;<br />
</code></p>
<p>The commas are only present in a CSS style, rather than in the text itself. For reasons which aren&#8217;t entirely clear to me, this means that they don&#8217;t make it into the clipboard when you copy/paste them.</p>
]]></content:encoded>
			<wfw:commentRss>http://www.danvk.org/wp/2011-03-09/commacopy/feed/</wfw:commentRss>
		<slash:comments>2</slash:comments>
		</item>
	</channel>
</rss>
