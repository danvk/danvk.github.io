<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN"><HTML><HEAD>	<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=iso-8859-1">	<TITLE>Screensaver</TITLE></HEAD><BODY BGCOLOR="#FFFFFF"><P><FONT SIZE="5"><B>Writing a Screen Saver in RB</B><BR>By Dan Vanderkam</FONT></P><P>&#160;&#160;If you're a regular reader of RBM, you'll remember the cover storyon extensions a few months back. For this issue, I've decided to give another, morepractical example of how this works.</P><P>&#160; As the title of this article implies, I'll be explaining how to make ascreensaver in RB...</P><P><FONT SIZE="4"><B>When to Activate</B></FONT></P><P>&#160;&#160;First, make a window like this:</P><P><IMG SRC="saver1.gif" WIDTH="115" HEIGHT="114" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;The timer's period should be set to 100, and the window's style shouldbe Global Floater. It should also have a black background. This window will allowus to check when the screensaver should be activated.</P><P>&#160;&#160;What precisely activates a screensaver? A lack of mouse movement andkey pressing of course! For this example though, we'll only be considering the mousecriteria.</P><P>&#160;&#160;Now, open up the code editor for this window, and create two new properties,like so:</P><P><IMG SRC="saver-vars.gif" WIDTH="179" HEIGHT="162" ALIGN="BOTTOM" BORDER="1"></P><P>&#160;&#160;These variables will represent the X and Y coordinates of the cursorat the last check, and the last point in time at which the mouse moved.</P><P>&#160;&#160;Now comes the code! Essentially, our code must do 5 things:<OL>	<LI>Find the mouse's X and Y coordinates.	<LI>Check to see if they have changed	<LI>If they have changed, then store them.	<LI>If they haven't changed, then check to see if they have changed in the past two	minutes	<LI>If it hasn't, then deactivate the timer, and activate the screensaver.</OL><P>&#160;&#160;It sounds like it'll be long and complicated, but it isn't (afterall, this is article has a limited length =) ). Anyway, step one is simple. Openup the code editor for the Timer. This code will do quite nicely:</P><P><IMG SRC="saver-code1.gif" WIDTH="146" HEIGHT="72" ALIGN="BOTTOM" BORDER="0"></P><P>&#160; That simply makes two variables, and puts the mouse's X and Y positionin them.</P><P>&#160;&#160;Now, for step two. This step is also simple, but it's very important.The results of it will control what the rest of the steps are. Because we'll storethe previous X and Y coordinate in the prevX and prevY variables, we only need tocheck if prevX=X, and if prevY=Y. This code will do that:</P><P><IMG SRC="saver-code2.gif" WIDTH="196" HEIGHT="130" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;Now that we're armed with the knowledge that step two provided us,we can proceed to step 3. This step is also quite simple. Because the mouse has moved,we must assign new prevX and prevY values, as well as updating the time that thelastChange variable contains. So, these simple statements will help immensely:</P><P><IMG SRC="saver-code3.gif" WIDTH="196" HEIGHT="162" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;For those not familiar with it, the ticks statement provides us withthe number of ticks (60ths of a second) since startup, and thus lets us store times.</P><P>&#160;&#160;Step 4 is up next. In this step, we must find out how much time haspassed since the last mouse movements. To do this, we'll use the Ticks function onceagain. For this particular example, the mouse must be perfectly still for two minutesbefore the screen saver activates. Two minutes contain 120 seconds. And, since asecond contains 60 ticks, there must be 120*60, or 7200 ticks in two minutes.</P><P>&#160;&#160;This routine will subtract the current time from the time stored inlastChange. If the difference is greater than 7200 (two minutes), then we can deactivatethis timer, and go on to step 5.</P><P><IMG SRC="saver-code4.gif" WIDTH="214" HEIGHT="215" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;Step 5 is the hardest one, and the one that gives you the most freedom.Therefore, it gets its own section.</P><P><FONT SIZE="4"><B>Making the Screen Saver</B></FONT></P><P>&#160;&#160;The term &quot;Screen Saver&quot; is actually a big lie. The niftyeffects that sceen savers generate actually <B>decrease</B> the lifetime of yourmonitor. But screen savers are fun, and most people have them.</P><P>&#160;&#160;For this example, we'll have colored lines dance across the screen.This will involve three steps:</P><OL>	<LI>Hide the menu bar	<LI>Make the window encloses the entire screen	<LI>Make the lines dance</OL><P>&#160;&#160;The first step isn't something that RB can do on its own. We'll needthe MenuBarMagic package. This is available at the RB Cafe (under XCMDs:User Interface),or from RBM's site, <A HREF="menumagic.hqx">here</A>. If you're viewing the offlineversion of this, then you already have the neccesary files.</P><P>&#160;&#160;Once you have the files, make a new folder in your project window,and call it &quot;MenuMagic&quot;. Next, place all of the files in it. Your projectwindow should look like this:</P><P><IMG SRC="saver-projwin.gif" WIDTH="210" HEIGHT="178" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;The MenuBarMagic module adds two important commands: HideMenuBar,and ShowMenuBar. Since MenuBarMagic requires it, you must also put the code &quot;InitMenuBarMagic&quot;into the window's Open event. If you don't, then the menu bar won't be hidden.</P><P>&#160;&#160;Since we'll be doing quite a bit of stuff to activate the screensaver,let's put it all into one method. Make a new method called &quot;DoSaver&quot;, withno parameters or return value. Also, we'll need to change the Timer's code to usethis method. The Timer's action event will now look like this:</P><P><IMG SRC="saver-code5.gif" WIDTH="212" HEIGHT="215" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;Now, in our &quot;DoSaver&quot; method, we'll use the HideMenuBarcommand that MenuBarMagic has provided us. Since this command is only one line, ourroutine is quite simple right now:</P><P><IMG SRC="saver-code6.gif" WIDTH="93" HEIGHT="43" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;I told you it was simple! Now, we have to add in the second step ofthe screen saver—blacking out the screen. One way to do this is to use a SpriteSurface.However, that severely limits what our screen saver can do. If you remember our onlywindow, it has a black background. There's a reason for that. If we move its topbeyond the upper-left corner of the screen, and make it large enough, its black interiorwill cover the screen, and achieve the same effect as a SpriteSurface would.</P><P>&#160;&#160;We'll do that first by setting the window's top and left to a positionwell beyond the top-left corner of the screen. Then, we use Screen(0).Width and Screen(0).Heightto stretch the window to a large enough size. Here's the code:</P><P><IMG SRC="saver-code7.gif" WIDTH="216" HEIGHT="106" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;In this particular method, Self means that we're accessing a propertyof the window. In this particular method, Me would have worked as well. There's onelast thing our method must do though. In the next section, we make a new timer, calledTimer2, which performs the screen saver's graphics. DoSaver must activate that timer,and deactivate Timer1. Here's the code for that:</P><P><IMG SRC="saver-codeF.gif" WIDTH="212" HEIGHT="114" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;Now comes the show!</P><P><FONT SIZE="4"><B>A Line Extravaganza</B></FONT></P><P>&#160;&#160;In our screen saver, one new line will appear every 10th of a second.So, let's create a new timer (Timer2), and set its Interval to 100. Set its Modeto zero.</P><P>&#160;&#160;Every window has a graphics object, and a global floater is no different.The command to draw a line in a graphics object is &lt;graphics&gt;.DrawLine X1,Y1, X2, Y2. We can specify the color using the Forecolor property. So here, completewith random number generators, is the line code for Timer2:</P><P><IMG SRC="saver-code8.gif" WIDTH="335" HEIGHT="103" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;Now, we need add a way to <B>stop</B> the screen saver. For this program,the screen saver will deactivate whenever the mouse is moved. We've done this before,so we can simply use code from Timer1 to test that. If the mouse <B>has</B> moved,then we'll call a method called &quot;StopSaver&quot;, which we'll make in the nextsection. This is the new code for Timer2:</P><P><IMG SRC="saver-code9.gif" WIDTH="330" HEIGHT="189" ALIGN="BOTTOM" BORDER="0"></P><P><FONT SIZE="4"><B>Deactivating the Screen Saver</B></FONT></P><P>&#160;&#160;To activate the screen saver, we did the following:<UL>	<LI>Stopped the Timer that checked for mouse inactivity	<LI>Hid the Menu Bar	<LI>Covered the screen in black	<LI>Started the Dancing Lines timer</UL><P>&#160;&#160;So, to deactivate the screen saver, we'll do the exact opposite:<UL>	<LI>Activate the Timer that checked for mouse inactivity	<LI>Show the Menu Bar	<LI>Remove the black cover from the screen	<LI>Stop the Dancing Lines timer</UL><P>&#160;&#160;To do this, we'll make a method called &quot;StopSaver&quot;. LikeDoSaver, it has no parameters or return value.</P><P>&#160;&#160;Activating the Mouse timer is simple.We'll just switch its mode to2. Stopping the Dancing Lines timer (Timer2) is also easy: we just switch its modeto 0. That leaves removing the cover.</P><P>&#160;&#160;If you recall, we covered the screen by streching out a window acrossit. In order for that covering to be quick, we covered the screen in one command.Now, we must uncover the screen in one command as well. Because the window is alreadyto the left of the screen, simply decreasing the width to make <B>all</B> of thewindow beyond the screen's edge will be easy. Since its Left is -100, setting itsWidth to 90 will do the trick. So, the code for StopSaver is as follows:</P><P><IMG SRC="image.gif" WIDTH="101" HEIGHT="68" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;That was simple enough! Your screen saver should now run perfectly!</P><P><FONT SIZE="4"><B>Making it an extension</B></FONT></P><P>&#160;&#160;Now that it works well as an application, let's make it an extension!To do this, compile it like a normal application. Then, open it in Resourcer (orResEdit), and open its SIZE resource. Look for a &quot;background application&quot;checkmark, and click it, like so</P><P><IMG SRC="saver-size.gif" WIDTH="227" HEIGHT="80" ALIGN="BOTTOM" BORDER="0"></P><P>&#160;&#160;This tells the Mac that our screen saver will function in the background.</P><P>&#160;&#160;Finally, change the application's type code from APPL to appe. Besure that it's lower case. Otherwise, the computer won't think that it's an extension!Drop it in your extensions folder, and reboot. The screen saver should function likeany good extension would.</P><P><FONT SIZE="4"><B>In Conclusion...</B></FONT></P><P>&#160;&#160;This is a nice little example of how to make an extension, and itshows how to black out the screen, wait for events, and the likes.</P><P>&#160;&#160;Like any program though, this one is far from perfect. If you likethis idea, here are some suggestions for other features:</P><UL>	<LI>The ability to change the wait time from an application	<LI>A &quot;sleep corner&quot;	<LI>Various other screen saver modules</UL></BODY></HTML>