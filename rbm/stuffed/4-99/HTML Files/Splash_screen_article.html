<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN"><HTML><HEAD>	<META HTTP-EQUIV="Content-Type" CONTENT="text/html;CHARSET=iso-8859-1">	<TITLE>Splash screen article.html</TITLE></HEAD><BODY BGCOLOR="#FFFFFF"><P><FONT SIZE="6"><B>Splash!</B></FONT><FONT SIZE="5"><BR></FONT><FONT SIZE="4"><B>A guide to creating Splash Screens</B></FONT></P><P>By <A HREF="mailto:EarthnMail@aol.com">Declan De Paor</A></P><P><FONT SIZE="4"><B>Introduction</B></FONT></P><P>&#160;&#160;When you discovered REALbasic, what was the first noticeable differencebetween it and other Mac applications? For me, it was the absence of a splash screenat launch time. Almost every commercial application starts with a splash screen -a window that appears on launch or when you select &quot;About application...&quot;under the Apple menu. But only the latter appearance occurs in REALbasic. When Iasked tech support about this, they replied that they consider splash screens anexcuse to disguise slow launching - and RB certainly does launch like grease lightning!</P><P>&#160;</P><CENTER><P><IMG SRC="Splash_screen_article.htm1.jpeg" WIDTH="284" HEIGHT="297" ALIGN="BOTTOM"BORDER="0" NATURALSIZEFLAG="3"></P></CENTER><CENTER><P>&#160;</P></CENTER><P>&#160;&#160;In general, however, the absence of a splash screen may be considereda sign of amateur authorship and an invitation to copy the application as if it werefreeware. So you may want to include one in your next project, if only to disguisethe fact that you are actually an amateur author, or to display license warnings,even though you don't actually have the Legal Department resources to pursue softwarepirates.</P><P><FONT SIZE="4"><B>No problem?</B></FONT></P><P>&#160;&#160;At first glance, programming the splash screen may seem a trivialtask. However, if you want to follow Apple guidelines precisely, you'll have to considerseveral issues. For example, in REALbasic itself, when you select About REALbasic...under the Apple menu, the application switcher menu doesn't go gray, which is a GUIno, no! After switching applications, the user may be left staring at the RB splashscreen even though the REALbasic application is now in the background. At launchtime, you want the splash screen to go away after a couple of seconds, or as soonas initialization and loading tasks are completed if the user clicks the mouse orpresses any key. But when the screen comes up at any later time, in response to a&quot;About My App...&quot; menu selection or &quot;Enter Registration Number...&quot;button, you want it to stay visible until dismissed by a mouse click or key press.</P><P>&#160;&#160;The splash screen should appear whether the user first double clicksthe application icon, double clicks a file with the appropriate creator, or dragsa readable file type onto the application icon, but it should not appear in any ofthese events if the application is already running. There does not appear to be anyconsensus about the use of a splash screen when the Finder sends files to a closedapplication for printing via an apple event, or when apple events are received fromother applications. For example, SimpleText does not show its splash screen at thistime but Photoshop does, presumably because it needs to load plug-ins. Either way,the splash screen certainly should not appear in response to an apple event if theapplication is already running. Finally, you shouldn't wait for the splash screento go away before starting to load a document, or documents, that the user double-clickedor dragged onto the application icon. Rather, documents should be loaded in the backgroundwhile the splash screen is visible. The user will be distracted for the first fewseconds and will not notice how long it really takes for the document to open.</P><P><FONT SIZE="4"><B>Let's do it!</B></FONT></P><P>&#160;&#160;Starting with REALbasic's default project, it's best not to use Window1for your splash screen. You want to be able to reuse your code in subsequent projectswithout any danger of overwriting another Window1 in which you've invested hoursof brilliant coding time, replacing it with a splash screen that tells you your ownname and address. OK, so you should have backed-up your precious Window1, or at leastrenamed it, but when was the last time you brushed your teeth after every meal likeyour mother told you to? So we'll call the splash screen &quot;AboutDlog&quot; andset its frame to Modal Dialog. Making it modal will ensure that the menubar is automaticallygrayed out, except for the Help menu, while the splash screen is visible.</P><P>&#160;&#160;Next, add the text fields you need to advertise your product. Forthis exercise, you'll also need an invisible static text field called &quot;ProgST.&quot;Add a timer object, timer1, with its mode set to &quot;off&quot;. The default periodof 1000 millisecs will do. The timer1 action method needs just one line of code:</P><P><TT>Self.Close</TT></P><P>&#160;&#160;<TT>Self</TT> is RB's slightly less-than-intuitive way of referringto the object containing Timer1, the AboutDlog window in this case, as opposed to<TT>me</TT>, which refers to the Timer1 object itself (did I say &quot;self?&quot;)Joan Armatrading will just have to rewrite her hit song &quot;<I>Me, Myself, I.</I>&quot;I suppose things could be worse; they could have called the parent object &quot;I.&quot;Anyway, Timer1 is now primed to close the splash screen one second (1000 milliseconds)after it's displayed. But don't panic - the clock doesn't start until it (<TT>me</TT>)is activated. While you have the above line of code handle, copy and paste it intotwo other events, keydown and mousedown. This will ensure that the AboutDlog is abortedwhen the user is fed up looking at it, even if the timer's period is not up.</P><P>&#160;&#160;To activate the timer, you can set <TT>Timer1.Mode = 1</TT> in code,but don't do this in the window's open event or the timer will be tripped every timethe window opens, which is not the behavior we want, as you'll realize if you werepaying attention up to now. Instead, create a new class called App, set its superto Application, and give it these properties:</P><P><CENTER><P><IMG SRC="Splash_screen_article.htm2.jpeg" WIDTH="178" HEIGHT="106" ALIGN="BOTTOM"BORDER="0" NATURALSIZEFLAG="3">.&#160;</P></CENTER><P>Under the App's open event, enter the following code:</P><P><TT>Sub Open()</TT></P><P><TT>//Edit Project &gt;Default window: = none<BR>Dim SINGLE_EVENT as integer<BR><BR>SINGLE_EVENT = 1<BR>&#160;<BR>AboutDlog1 = new AboutDlog<BR>AboutDlog1.timer1.mode = SINGLE_EVENT<BR>AboutDlog1.visible = true<BR>&#160;<BR>AboutDlog1.ProgST.visible = true<BR>AboutDlog1.ProgST.text = &quot;Initializing...&quot;<BR>InitTasks // My App method<BR>&#160;<BR>AboutDlog1.ProgST.text = &quot;Loading prefs...&quot;<BR>LoadPrefs (&quot;My AppName&quot;) // My App method<BR>AboutDlog1.ProgST.visible = false<BR>DocsVis = false<BR><BR>End Sub</TT></P><P>&#160;&#160;The first comment reminds you to Edit the Project Settings... so thatthe Default window reads &quot;none.&quot; This way, Sub Open() will be executedwhen you run your project (think of it as Sub Main() if you're coming from anotherlanguage like C) and the pesky default window won't try to hog the limelight. I'veused upper case in the <TT>SINGLE_EVENT</TT> for the sake of convention for thosewho might port this code to Visual Basic.</P><P>&#160;&#160;The open event occurs only once, immediately upon launch of the application,but only if the Default window is set to none. Notice that AboutDlog1 is not dimensionedlocally. It is defined as a property of the App class so that it will be availablefor reference outside of Sub Open(). Because we're entering code in the App subclass,not directly into AboutDlog1, we must use the &quot;AboutDlog1.&quot; prefix. Makingthe dialog window visible is probably superfluous if you did what you were told upto now, since it ought to be visible by default. Call this defensive coding (or knickerfolding, in the parlance of the part of the world I come from). Toggling the visibilityof the ProgST static text field and setting the DocsVis property to false is moreof the same (knicker folding, that is) - I want this code to work, or at least alertyou, even if you didn't do what you were told and forgot to make ProgST invisibleby default or to create a DocsVis boolean property.</P><P>&#160;&#160;The remainder of the open event code is optional. If you want to performany time-consuming tasks at launch time, perhaps to make your program appear heavyweightand thus worth paying for, put them in a new method called InitTasks. If your applicationis so simple that it requires no initialization tasks, you can always access somearbitrary folderItems. This will cause disk-whirring sounds and convince the userthat your application is doing something jolly clever! Locating the call to InitTaskshere in Sub Open() ensures that these tasks will not be repeated, for example whenfiles are dragged onto the application icon at a later time. This is also a goodplace to read your preferences file, if any. You might want to check the user's licensenumber and activate a &quot;Register&quot; button or cripple the software if thecopy is unregistered. For the present exercise, we just create an empty InitTasksmethod and a LoadPrefs method with one line of code (for a fully fledged Prefs file,contact Don Zouras, <A HREF="mailto:dzouras@wwa.com">dzouras@wwa.com</A>):</P><P><TT>Sub InitTasks()<BR>//Do Initialization tasks here<BR><BR>End Sub<BR>&#160;<BR>Sub LoadPrefs (appName as string)<BR>//Open the prefs file or set defaults<BR>&#160;<BR>DefaultDoc = true<BR><BR>End Sub</TT></P><P>&#160;&#160;DefaultDoc, one of the boolean properties we gave to the App subclasswhen we created it, serves as a flag to tell us whether to create a default documentwhen the splash screen is through. But we're not quite through with the splash screenjust yet. While it's still visible, we should check whether there are documents tobe opened, either because they were double-clicked, dragged onto the applicationicon, sent for printing by the Finder, or sent via another apple event. You mightexpect to find code in Sub Open() to handle these eventualities. But no, there'snothing much else between LoadPrefs and End Sub. That's because said eventualitiestrigger their own events. Read on...</P><P><FONT SIZE="4"><B>Dealing with Documents</B></FONT></P><CENTER><P><IMG SRC="Splash_screen_article.htm3.jpeg" WIDTH="169" HEIGHT="127" ALIGN="BOTTOM"BORDER="0" NATURALSIZEFLAG="3">&#160;</P></CENTER><P>&#160;&#160;As stated above, the App subclass's Open event occurs only once, atlaunch time. Depending on how the application was launched, one of three events followsstraight away. If the application was double-clicked, the NewDocument event occurs.If a file was opened, OpenDocument occurs, and if the Finder or another applicationsent a document then HandleAppleEvent occurs. To continue developing your project,open up Sub NewDocument() and enter the following code:</P><P><TT>Sub NewDocument()<BR>//Application icon was double-clicked<BR><BR>If DefaultDoc then<BR>OpenNewDoc // My App method<BR>end if<BR>&#160;<BR>End Sub</TT><BR>&#160;<BR>Next, add the following new method to the app subclass,<BR>&#160;<BR><TT>Sub OpenNewDoc()<BR>//Increment the title number so users won't<BR>// accidentally replace last doc when saving<BR>&#160;<BR>Dim w as Window1<BR>&#160;<BR>UntitledCount = UntitledCount + 1<BR>w = new Window1<BR>w.title = &quot;Untitled &quot; + str (UntitledCount)<BR>w.visible = DocsVis<BR>virginDoc = true<BR>&#160;<BR>End Sub</TT></P><P>&#160;&#160;You may well ask why we don't do all of this in Sub NewDocument().The answer is that Sub OpenNewDoc will also be called in respond to the application'sFileNew menu. The only difference between opening a new document at launch time andlater is that DocsVis is set to false at launch time, which hides the new instanceof Window1 while the splash screen is up. The virginDoc property is set to alertus later on if the user decides to open a document using the application's FileOpenmenu. A real professional will get rid of a virgin Untitled window before openingan existing document. Which brings us to the next event.</P><P>&#160;&#160;If a document was double clicked or dragged onto to the applicationicon, the App subclass's OpenDocument event occurs. You need the following code tohandle this event.</P><P><TT>Sub OpenDocument (item as folderItem)<BR>//Doc file(s) double-clicked or dragged onto appl icon<BR>&#160;<BR>AboutWnd1.ProgST.text = &quot;Reading data...&quot;<BR>DocsVis = false<BR>OpenOldDoc(item)<BR>&#160;<BR>End Sub<BR>&#160;<BR>Sub OpenOldDoc(f as folderItem)<BR>// called by OpenDocument()<BR>// or by the FileOpen menu handler<BR>&#160;<BR>Dim w as Window1<BR>&#160;<BR>w = new Window1<BR>w.visible = DocsVis<BR>w.title = f.Name<BR>&#160;<BR>//read document data here<BR>&#160;<BR>End Sub</TT></P><P>&#160;&#160;Again, the code is split between two Subs because we will also wantto open documents using the application's FileOpen menu handler. It's up to you toadd the appropriate code for reading document data, which could be text, graphics,or some data structure I've never heard of.</P><P>&#160;&#160;The final event that can happen at launch time is an Apple Event.We will only handle one case here, by entering the following code in the HandleAppleEventfunction,</P><P><TT>Function HandleAppleEvent(event as AppleEvent,eventClass as string, eventIDas string) as boolean<BR><BR>If eventClass = &quot;aevt&quot; then<BR>If eventID = &quot;pdoc&quot; then<BR>PrintDoc // My App Method<BR>return true<BR>End If<BR>End If<BR>&#160;<BR>End Function<BR>&#160;<BR>which necessitates adding a new method called PrintDoc,<BR>&#160;<BR>Sub PrintDoc()<BR>// print your docs here<BR>&#160;<BR>Beep<BR>&#160;<BR>End Sub</TT></P><P>&#160;&#160;Again, I've no way of knowing how to print your data, so you're onyour own from the word Beep. IF you do handle the Apple Event, be nice and tell thecalling app (the Finder in this case) by returning true. For more info on printing,check out this month's <A HREF="coverstory.html">cover story</A>.</P><P><FONT SIZE="4"><B>Making it work</B></FONT></P><P>There's still one App subclass event that requires code. Not much will happenif we don't make the application's menus accessible:</P><P><TT>Sub EnableMenuItems()<BR>// User has clicked the menubar<BR><BR>AppleAbout.Enable<BR>FileNew.enable<BR>FileOpen.enable<BR>&#160;<BR>End Sub&#160;</TT></P><P>&#160;&#160;Of course this will trip an error unless you create an Apple menuitem called &quot;About.&quot; Since we're all done with the App events, now is agood time to double-click the Menu object in the Project window and add the necessarynew menu items:&#160;</P><P><IMG SRC="Splash_screen_article.htm4.jpeg" WIDTH="208" HEIGHT="133" ALIGN="BOTTOM"BORDER="0" NATURALSIZEFLAG="3"> <IMG SRC="Splash_screen_article.htm5.jpeg" WIDTH="207"HEIGHT="134" ALIGN="BOTTOM" BORDER="0" NATURALSIZEFLAG="3"></P><P>&#160;&#160;While you're in there, you may as well create the FileNew and FileOpenitems also. Since we've got these new menu items, we'd better create handlers forthem. To do this, select Edit&gt; New Menu Handler... and make three handlers</P><CENTER><P><IMG SRC="Splash_screen_article.htm6.jpeg" WIDTH="133" HEIGHT="71" ALIGN="BOTTOM"BORDER="0" NATURALSIZEFLAG="3"></P></CENTER><P>The associated code looks like this, respectively:</P><P><TT>Function Action As Boolean<BR>//Handle the Apple menu's About item<BR>//Open AboutDlog1 &amp; disable its timer<BR>&#160;<BR>Dim OFF As boolean<BR>&#160;<BR>// Some day we'll have RB constants!<BR>OFF = 0<BR>AboutDlog1 = new aboutDlog<BR>AboutDlog1.timer1.mode = OFF<BR>AboutDlog1.visible = true<BR>AboutDlog1.ProgST = false<BR>&#160;<BR>End Function<BR>&#160;<BR><BR>Function Action As Boolean<BR>//Handle FileNew<BR>&#160;<BR>DocsVis = true<BR>OpenNewDoc<BR>End Function<BR>&#160;<BR><BR>Function Action As Boolean<BR>//Handle FileOpen<BR>&#160;<BR>Dim f As folderItem<BR>&#160;<BR>f = GetOpenFolderItem(&quot;text&quot;)<BR>If f = nil then //user cancelled action<BR>MsgBox &quot;Make up your bloody mind&quot;<BR>else<BR>DocsVis = true<BR>OpenOldDoc(f)<BR>End if<BR>&#160;<BR>End Function</TT><BR>&#160;<BR>&#160;&#160;On second thoughts, better comment out that message box! Notice how thetimer is disabled when the splash screen opens in response to an AppleAbout selection.Also note that DocsVis is set to true when documents are created or opened from themenubar, as opposed to those created or opened at launch time, which were kept invisible.</P><P>&#160;&#160;So when do we get to see those invisible documents? After the splashscreen goes away, of course! To make this happen, add one more new method calledAboutDone to the App subclass, which should now have the following methods:</P><P>&#160;</P><CENTER><P><IMG SRC="Splash_screen_article.htm7.jpeg" WIDTH="121" HEIGHT="39" ALIGN="BOTTOM"BORDER="0" NATURALSIZEFLAG="3"></P></CENTER><P>&#160;</P><P>Enter the following code in the AboutDone method,</P><P><TT>Sub AboutDone()<BR>// make pre-loaded docs visible after aboutDlog is closed<BR>&#160;<BR>Dim i As Integer<BR>&#160;<BR>i = WindowCount<BR>While i &gt; 0<BR>i = i - 1<BR>Window(i).visible = true<BR>Wend<BR>&#160;<BR>//Henceforth, documents will be instantly visible<BR>DocsVis = true<BR>&#160;<BR>End Sub</TT></P><P>&#160;&#160;The order of the two lines within the While loop is important, sinceRB keeps a list of open application windows from Window(0) through Window(WindowCount-1).</P><P>&#160;&#160;All that remains is to make this method occur when the AboutDlog windowcloses. So go back into the AboutDlog code editor and open up its Close event,</P><CENTER><P>&#160;<IMG SRC="Splash_screen_article.htm8.jpeg" WIDTH="87" HEIGHT="57" ALIGN="BOTTOM"BORDER="0" NATURALSIZEFLAG="3"></P></CENTER><P>&#160;&#160;Enter the following code to send the good news to the app subclass'sAboutDone routine:</P><P><TT>Sub Close()<BR>// report AboutDlog closure back to App<BR>&#160;<BR>App.AboutDone<BR>&#160;<BR>End Sub</TT></P><P>&#160;&#160;Ok, are you ready to make a big Splash!? <B><I>- Declan de Paor</I></B></BODY></HTML>