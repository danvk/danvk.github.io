---
title: Boggle Solver
layout: nil
---

<style>
/* CSS arithmetic! */
.arrow { width: 15px; height: 15px; }

.arrow.up    { background-image: url(arrows/up.png); }
.arrow.down  { background-image: url(arrows/down.png); }
.arrow.left  { background-image: url(arrows/left.png); }
.arrow.right { background-image: url(arrows/right.png); }

.arrow.up.left     { background-image: url(arrows/upleft.png); }
.arrow.down.left   { background-image: url(arrows/downleft.png); }
.arrow.up.right    { background-image: url(arrows/upright.png); }
.arrow.down.right  { background-image: url(arrows/downright.png); }

.arrow.left.right.up   { background-image: url(arrows/upleftright.png); }
.arrow.left.right.down { background-image: url(arrows/downleftright.png); }
.arrow.up.down.left    { background-image: url(arrows/leftupdown.png); }
.arrow.up.down.right   { background-image: url(arrows/rightupdown.png); }
</style>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script src="//fb.me/react-with-addons-0.11.2.js"></script>
<script src="//fb.me/JSXTransformer-0.11.2.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>

<script type="text/jsx;harmony=true">
/** @jsx React.DOM */
var ENDPOINT = 'http://webboggle.herokuapp.com/';
function getSolution(letters) {
  return $.get(ENDPOINT + letters);
}

var cx = React.addons.classSet;


var ARROWS = {
  UP: 'up',
  LEFT: 'left',
  DOWN: 'down',
  RIGHT: 'right',
};

var BogglePage = React.createClass({
  getInitialState: function() {
    return {
      board: [
                'pers'.split(''),
                'latg'.split(''),
                'sine'.split(''),
                'ters'.split('')
             ],
      // Array of (row, col)
      path: [[0, 0], [0, 1], [0, 2], [1, 2], [2, 2], [3, 3], [2, 3], [3, 2]]
    }
  },
  render: function() {
    return <BoggleBoard board={this.state.board}
                        selectedPath={this.state.path} />;
  }
});


var BoggleBoard = React.createClass({
  propTypes: {
    board: React.PropTypes.arrayOf(React.PropTypes.arrayOf(React.PropTypes.string)).isRequired,
    selectedPath: React.PropTypes.array
  },
  render: function() {
    var bd = this.props.board;
    var path = this.props.selectedPath;
    var pathPairs = _.zip(path, _.rest(path));
    pathPairs.pop();

    var inRowArrows = _.range(4).map(() => []);
    var betweenRowArrows = _.range(3).map(() => []);
    pathPairs.forEach(function(pair) {
      var beforeRow = pair[0][0], afterRow = pair[1][0];
      if (beforeRow == afterRow) {
        inRowArrows[beforeRow].push(pair);
      } else {
        betweenRowArrows[Math.min(beforeRow, afterRow)].push(pair);
      }
    });

    return (
      <table className="boggle-board">
        <BoggleLetterRow row={0} letters={bd[0]} selectedPath={inRowArrows[0]} />
        <BoggleArrowRow rowAbove={0} selectedPath={betweenRowArrows[0]} />
        <BoggleLetterRow row={1} letters={bd[1]} selectedPath={inRowArrows[1]} />
        <BoggleArrowRow rowAbove={1} selectedPath={betweenRowArrows[1]} />
        <BoggleLetterRow row={2} letters={bd[2]} selectedPath={inRowArrows[2]} />
        <BoggleArrowRow rowAbove={2} selectedPath={betweenRowArrows[2]} />
        <BoggleLetterRow row={3} letters={bd[3]} selectedPath={inRowArrows[3]} />
      </table>
    );
  }
});

var BoggleLetterRow = React.createClass({
  propTypes: {
    row: React.PropTypes.number.isRequired,
    letters: React.PropTypes.arrayOf(React.PropTypes.string).isRequired,
    selectedPath: React.PropTypes.array  // array of (beforeCell, afterCell) in this row.
  },
  render: function() {
    var lets = this.props.letters;
    var arrows = _.range(3).map(() => ({arrow:true}));
    this.props.selectedPath.forEach(function(pair) {
      var beforeCol = pair[0][1], afterCol = pair[1][1];
      var c = Math.min(beforeCol, afterCol);
      if (beforeCol < afterCol) {
        arrows[c][ARROWS.RIGHT] = true;
      } else {
        arrows[c][ARROWS.LEFT] = true;
      }
    });

    return (
      <tr>
        <td><div>{lets[0]}</div></td>
        <td><div className={cx(arrows[0])} /></td>
        <td><div>{lets[1]}</div></td>
        <td><div className={cx(arrows[1])} /></td>
        <td><div>{lets[2]}</div></td>
        <td><div className={cx(arrows[2])} /></td>
        <td><div>{lets[3]}</div></td>
      </tr>
    );
  }
});

function makeDiagArrow(pair, arrow) {
  var beforeCol = pair[0][1], beforeRow = pair[0][0],
      afterCol = pair[1][1], afterRow = pair[1][0];
  var A = ARROWS;
  if (beforeCol < afterCol) {
    arrow[A.RIGHT] = true;
    if (beforeRow < afterRow) {
      arrow[A.DOWN] = true;
    } else {
      arrow[A.UP] = true;
    }
  } else {
    arrow[A.LEFT] = true;
    if (beforeRow < afterRow) {
      arrow[A.DOWN] = true;
    } else {
      arrow[A.UP] = true;
    }
  }
}

var BoggleArrowRow = React.createClass({
  propTypes: {
    rowAbove: React.PropTypes.number.isRequired,
    selectedPath: React.PropTypes.array
  }, 
  render: function() {
    var vertArrows = _.range(4).map(() => ({arrow:true}));
    var diagArrows = _.range(3).map(() => ({arrow:true}));
    this.props.selectedPath.forEach(function(pair) {
      var beforeCol = pair[0][1], beforeRow = pair[0][0],
          afterCol = pair[1][1], afterRow = pair[1][0];
      var c = Math.min(beforeCol, afterCol);
      if (beforeCol == afterCol) {
        if (beforeRow < afterRow) {
          vertArrows[c][ARROWS.DOWN] = true;
        } else {
          vertArrows[c][ARROWS.UP] = true;
        }
      } else {
        // TODO(danvk): validate that this is a plausible combination of arrows.
        makeDiagArrow(pair, diagArrows[c]);
      }
    });
    return (
      <tr>
        <td><div className={cx(vertArrows[0])} /></td>
        <td><div className={cx(diagArrows[0])} /></td>
        <td><div className={cx(vertArrows[1])} /></td>
        <td><div className={cx(diagArrows[1])} /></td>
        <td><div className={cx(vertArrows[2])} /></td>
        <td><div className={cx(diagArrows[2])} /></td>
        <td><div className={cx(vertArrows[3])} /></td>
      </tr>
    );
  }
});
</script>

<div id="boggle-page">
</div>

<script type="text/jsx;harmony=true">
/** @jsx React.DOM */
bogglePage = React.renderComponent(<BogglePage />, $('#boggle-page').get(0));
</script>
